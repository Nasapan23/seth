// Seth - OpenClaw Configuration Template (Auto-Routing Edition)
// Copy to data/openclaw/openclaw.json and customize
// JSON5 format: comments and trailing commas allowed
//
// MODEL ROUTING STRATEGY:
// - FREE tier: Google Gemini for casual chat (zero cost with GOOGLE_AI_API_KEY)
// - CODING tier: Claude Sonnet for code tasks (auto-triggered)
// - SMART tier: Claude Sonnet for complex tasks (manual /model smart)
// - Sub-agents: CHEAP model (workers don't need to be smart)
// - Thinking: OFF by default (saves tokens)
// - Fallbacks: FREE OpenRouter models when rate-limited
//
// Documentation: https://docs.openclaw.ai/gateway/configuration

{
  // =========================================================================
  // Gateway Configuration
  // =========================================================================
  gateway: {
    mode: "local",
    bind: "lan",
    port: 18789,
    auth: {
      mode: "token",
    },
  },

  // =========================================================================
  // Provider Configuration (API Keys synced from environment)
  // =========================================================================
  // API keys are synced from environment variables by entrypoint.sh
  // Set these in .env file, not here:
  //   - OPENROUTER_API_KEY (access to all models via OpenRouter)
  //   - GOOGLE_AI_API_KEY (direct Gemini access, FREE tier)
  //   - ANTHROPIC_API_KEY (direct Anthropic access)
  //   - OPENAI_API_KEY (direct OpenAI access)
  env: {
    // Keys injected at runtime from environment
  },

  // =========================================================================
  // Auto Model Routing (Task-Based Selection)
  // =========================================================================
  routing: {
    enabled: true,  // Set SETH_AUTO_ROUTING=false to disable
    
    // Default model when no pattern matches (uses FREE tier if available)
    defaultModel: "${SETH_FREE_MODEL}",  // google/gemini-3-flash-preview
    
    // Pattern-based routing rules
    rules: [
      {
        name: "coding",
        // Triggers: code, debug, fix, implement, language names
        patterns: [
          "code", "debug", "fix", "implement", "refactor",
          "function", "class", "variable", "error",
          "typescript", "python", "javascript", "java", "rust", "go", "sql",
          "html", "css", "react", "vue", "node"
        ],
        model: "${SETH_CODING_MODEL}",  // openrouter/anthropic/claude-sonnet-4
      },
      {
        name: "research",
        // Triggers: search, find, lookup, weather, news
        patterns: ["search", "find", "research", "lookup", "weather", "news", "what is", "who is"],
        delegate: "researcher",  // Delegate to researcher sub-agent
      },
    ],
    
    // Explicit command overrides (/code, /free, /smart, /research)
    commands: {
      "/code": "${SETH_CODING_MODEL}",
      "/free": "${SETH_FREE_MODEL}",
      "/smart": "openrouter/anthropic/claude-sonnet-4",
      "/research": { delegate: "researcher" },
    },
  },

  // =========================================================================
  // Agent Configuration (Auto-Routing Enabled)
  // =========================================================================
  agents: {
    defaults: {
      workspace: "/home/seth/workspace",
      
      // PRIMARY: Cheap model for casual chat, greetings, simple Q&A
      // Switch to smart model with: /model smart
      model: {
        primary: "${SETH_MODEL}",  // openrouter/anthropic/claude-3-haiku
        fallbacks: [
          "openrouter/meta-llama/llama-3.3-70b-instruct:free",
          "openrouter/google/gemma-2-9b-it:free",
        ],
      },
      
      // MODEL ALIASES - switch with /model <alias>
      // Models available via OpenRouter: https://openrouter.ai/models
      // Direct Google Gemini: https://aistudio.google.com
      models: {
        // FREE tier - Google Gemini (direct API, $0 cost)
        // Requires GOOGLE_AI_API_KEY in environment
        "google/gemini-3-flash-preview": { alias: "free" },
        
        // CODING tier - auto-selected for code tasks
        "openrouter/anthropic/claude-sonnet-4": { alias: "coding" },
        
        // Cheap models - ~$0.25/1M input
        "openrouter/anthropic/claude-3-haiku": { alias: "cheap" },
        "openrouter/openai/gpt-4o-mini": { alias: "mini" },
        
        // Smart models (for complex tasks) - ~$3/1M input
        "openrouter/anthropic/claude-sonnet-4": { alias: "smart" },
        "openrouter/openai/gpt-4o": { alias: "gpt" },
        
        // Maximum power (use sparingly!) - ~$15/1M input
        "openrouter/anthropic/claude-opus-4": { alias: "opus" },
        
        // Open source alternatives
        "openrouter/meta-llama/llama-3.3-70b-instruct": { alias: "llama" },
        "openrouter/google/gemini-2.0-flash-001": { alias: "gemini" },
        
        // Future: local models via Ollama
        // "ollama/llama3.3": { alias: "local" },
      },
      
      // Sandbox: disabled inside container (already isolated)
      sandbox: {
        mode: "off",
      },
      
      // Sub-agents: use CHEAP model (workers don't need to be smart)
      subagents: {
        model: "${SETH_SUBAGENT_MODEL}",  // openrouter/anthropic/claude-3-haiku
        maxConcurrent: 4,
      },
      
      // THINKING: OFF by default to save tokens
      // Enable for complex tasks: /thinking high
      thinkingDefault: "off",
      
      // Timeout for agent runs (seconds)
      timeoutSeconds: 900,
    },
    
    // Agent definitions - extend for multi-agent "employee system"
    list: [
      {
        id: "main",
        default: true,
        identity: {
          name: "Seth",
          theme: "secure personal assistant and task manager",
          emoji: "ü§ñ",
        },
        subagents: {
          allowAgents: ["*"],
        },
      },
      // Specialized workers (all use cheap models by default)
      // Uncomment to enable:
      //
      // {
      //   id: "researcher",
      //   model: "anthropic/claude-haiku-3",  // Cheap for research
      //   identity: { name: "Researcher", emoji: "üîç" },
      //   tools: { allow: ["web_search", "web_fetch", "browser", "read"] },
      // },
      // {
      //   id: "summarizer", 
      //   model: "anthropic/claude-haiku-3",  // Cheap for summaries
      //   identity: { name: "Summarizer", emoji: "üìù" },
      //   tools: { allow: ["read", "write"] },
      // },
    ],
  },

  // =========================================================================
  // Browser Configuration (Full Playwright Control)
  // =========================================================================
  browser: {
    enabled: true,
    defaultProfile: "openclaw",
    headless: true,
    noSandbox: true,  // Required inside Docker
    color: "#FF4500",
    // Snapshot defaults for efficiency
    snapshotDefaults: {
      mode: "efficient",
    },
    profiles: {
      openclaw: {
        cdpPort: 18800,
        color: "#FF4500",
      },
    },
  },

  // =========================================================================
  // Skills Configuration
  // =========================================================================
  skills: {
    load: {
      extraDirs: ["/opt/seth/skills"],
      watch: true,
    },
  },

  // =========================================================================
  // Tool Configuration (Full Power - Container Isolated)
  // =========================================================================
  tools: {
    // All tools enabled by default - container provides isolation
    // Use deny list only for tools you explicitly want to block
    deny: [
      "canvas",  // No UI canvas in headless Docker
      "nodes",   // No companion app nodes
    ],
    
    // Elevated mode disabled (container is the boundary)
    elevated: {
      enabled: false,
    },
    
    // Exec tool configuration
    exec: {
      notifyOnExit: true,
      pathPrepend: ["/home/seth/.local/bin"],
    },
    
    // Web tools (search + fetch)
    web: {
      search: {
        enabled: true,
        maxResults: 10,
      },
      fetch: {
        enabled: true,
        maxChars: 50000,
      },
    },
    
    // Sub-agent tool policy (what sub-agents can use)
    subagents: {
      tools: {
        deny: ["gateway", "cron"],  // Sub-agents can't restart gateway or schedule
      },
    },
  },

  // =========================================================================
  // Cron Jobs (Scheduled Tasks)
  // =========================================================================
  cron: {
    enabled: true,
    maxConcurrentRuns: 2,
  },

  // =========================================================================
  // Heartbeat (Proactive Agent)
  // =========================================================================
  heartbeat: {
    enabled: false,  // Enable when you want proactive check-ins
    // intervalMinutes: 30,
    // tasks: ["check reminders", "review pending items"],
  },

  // =========================================================================
  // Memory (Persistent Knowledge)
  // =========================================================================
  memory: {
    enabled: true,
    // Search results limit
    searchLimit: 20,
  },

  // =========================================================================
  // Messages Configuration
  // =========================================================================
  messages: {
    responsePrefix: "[Seth]",
    ackReaction: "ü§ñ",
    queue: {
      mode: "collect",
      debounceMs: 1000,
      cap: 20,
    },
    // Group chat settings
    groupChat: {
      mentionPatterns: ["@seth", "@Seth"],
    },
  },

  // =========================================================================
  // Logging Configuration
  // =========================================================================
  logging: {
    level: "info",
    consoleStyle: "pretty",
    redactSensitive: "tools",
  },

  // =========================================================================
  // Session Configuration
  // =========================================================================
  session: {
    pruning: {
      enabled: true,
      maxAgeDays: 30,
    },
  },

  // =========================================================================
  // Commands (Slash Commands)
  // =========================================================================
  commands: {
    // Allow gateway restart via /restart command
    restart: false,  // Keep false for security
  },

  // =========================================================================
  // Messaging Channels
  // =========================================================================
  channels: {
    // Telegram Bot Integration
    // Set TELEGRAM_BOT_TOKEN in environment to enable
    // Create bot via @BotFather on Telegram
    telegram: {
      enabled: false,  // Set to true when TELEGRAM_BOT_TOKEN is configured
      // botToken: injected from TELEGRAM_BOT_TOKEN env var
      
      // Restrict access to specific Telegram user IDs (optional)
      // Leave empty to allow all users
      // Get your ID by messaging @userinfobot on Telegram
      allowedUsers: [],  // e.g., ["123456789", "987654321"]
      
      // Use polling (simpler) or webhook (more efficient for high traffic)
      polling: {
        enabled: true,
        interval: 1000,  // ms between polls
      },
      webhook: {
        enabled: false,
        // url: "https://your-domain.com/webhook/telegram",
        // secret: "your-webhook-secret",
      },
    },
    
    // Future channels (Phase 2+)
    // discord: { enabled: false },
    // slack: { enabled: false },
    // whatsapp: { enabled: false },
  },
}
